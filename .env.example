# Backend API port
PORT=3001

# OTP provider: use "twilio_verify" in production
# For local development you may temporarily use "mock"
OTP_PROVIDER=twilio_verify

# Wallet authentication:
# - true: require strict cryptographic signature verification
# In production this is enforced by startup validation.
WALLET_AUTH_STRICT=true
# Non-production only: if strict verification fails due runtime sandbox restrictions
# (e.g. EPERM on child-process in constrained environments), temporarily allow onboarding.
WALLET_AUTH_ALLOW_RUNTIME_RELAXED=true

# Twilio Verify (required when OTP_PROVIDER=twilio_verify)
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_VERIFY_SERVICE_SID=VAxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Key encryption pepper (required in production)
WALLET_ENCRYPTION_PEPPER=replace-this-with-a-long-random-secret

# Ledger mode:
# - true: backend treats on-chain transactions as canonical and does not mutate local settlement balances/positions
# - false: backend runs simulated settlement ledger updates for demo mode
ENFORCE_ONCHAIN_LEDGER=true

# Blind relayer submit endpoint (non-mock mode)
ALEO_RELAY_SUBMIT_URL=https://api.explorer.provable.com/v1/testnet/transaction/broadcast

# Relay payload mode:
# - auto: try to parse serializedTransaction JSON, fallback to wrapped payload
# - raw: send parsed JSON directly (required by some Aleo endpoints)
# - wrapped: send { "transaction": "<serialized>" }
ALEO_RELAY_PAYLOAD_MODE=raw

# Optional SDK version header for Aleo relay
ALEO_SDK_VERSION=0.7.4

# Optional relay status endpoint base (server appends /:txId)
# ALEO_RELAY_STATUS_URL=https://api.explorer.provable.com/v2/testnet/transaction

# Optional custom DB path
# APP_DB_PATH=./data/app.db

# Yield program id used by the relayer quote->transition solver
ALEO_YIELD_PROGRAM_ID=envelop_yield.aleo
ALEO_SWAP_PROGRAM_ID=envelop_swap.aleo
ALEO_PAYMENTS_PROGRAM_ID=envelop_payments.aleo
ALEO_INVOICE_PROGRAM_ID=envelop_invoice.aleo

# Identity program + transition used to validate username claims
ALEO_IDENTITY_PROGRAM_ID=envelop_identity_v2.aleo
ALEO_IDENTITY_REGISTER_FUNCTION=register_username
# Set to true only for legacy identity programs that expose private inputs.
# ALEO_IDENTITY_ALLOW_PRIVATE_INPUT_CLAIMS=false
# Set to true only if you want strict fee-output payer matching.
# Some wallet/explorer payloads expose fee outputs in a non-user-owned form.
ALEO_IDENTITY_ENFORCE_FEE_PAYER_MATCH=false

# Feature tx verification policy:
# Each execute endpoint verifies the confirmed tx executes one of the allowed functions.
# Comma-separated function names.
ALEO_SWAP_ALLOWED_FUNCTIONS=create_swap_request,settle_swap,settle_swap_onchain
ALEO_PAYMENTS_ALLOWED_FUNCTIONS=create_payment_intent,settle_payment,settle_payment_onchain
ALEO_INVOICE_CREATE_ALLOWED_FUNCTIONS=create_invoice
ALEO_INVOICE_PAY_ALLOWED_FUNCTIONS=pay_invoice,pay_invoice_onchain
ALEO_YIELD_ALLOWED_FUNCTIONS=stake,stake_onchain,unstake,unstake_onchain,claim,claim_onchain,rebalance,rebalance_onchain
# Optional strict fallback when explorer payload omits execution owner.
ALEO_TX_ENFORCE_FEE_PAYER_MATCH=false

# Username recipient resolution mode:
# - true  => resolve recipient usernames only from verified on-chain identity claims
# - false => fallback to legacy users.username rows when claim index is missing
IDENTITY_REQUIRE_ONCHAIN_RECIPIENT=true

# Passkey / WebAuthn relying party settings
PASSKEY_RP_NAME=Envelop Private Finance
# PASSKEY_RP_ID=localhost
# PASSKEY_EXPECTED_ORIGINS=http://localhost:3000
